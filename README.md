![MIT license](https://img.shields.io/badge/license-MIT-green.svg?style=plastic "MIT")
![Version v0.0.0](https://img.shields.io/badge/version-v0.0.0-blue.svg?style=plastic "Version v0.0.0")

[![Conventional Commits](https://img.shields.io/badge/Conventional%20Commits-1.0.0-yellow.svg)](https://conventionalcommits.org)

![Go](https://img.shields.io/badge/Go-1.21-yellow.svg?style=plastic "Go")

# Version

A Linux utility for versioning using [semver](https://semver.org) and changelog generation via [Conventional Commits Specification](https://www.conventionalcommits.org/en/v1.0.0).

## Installation

```bash
wget https://raw.githubusercontent.com/klimby/version/master/bin/version -O version 

sudo chmod +x ./version
```

## Usage

### Common help

```bash
$ ./version --help
CLI tool for versioning, generate changelog, bump version.

Usage:
  version [command]

Available Commands:
  generate    Generate files
  help        Help about any command
  next        Generate next version
  remove      Remove files

Flags:
  -b, --backup          backup changed files
  -c, --config string   config file path (default "version.yaml")
      --dir string      working directory, default - current
  -d, --dry             dry run
  -f, --force           force mode
  -h, --help            help for version
  -s, --silent          silent run
```

### Generate command

Generate full changelog and config file:

```bash
$ version generate --help
CLI tool for versioning, generate changelog, bump version.

Usage:
  version generate [flags]

Flags:
      --changelog     generate changelog file
      --config-file   generate config file
  -h, --help          help for generate

Global Flags:
  -b, --backup          backup changed files
  -c, --config string   config file path (default "version.yaml")
      --dir string      working directory, default - current
  -d, --dry             dry run
  -f, --force           force mode
  -s, --silent          silent run
```

#### Config file

After generating config file you can edit it:

```yaml
# Version configuration file.
# Generated by Version 1.0.0.

# Application settings.
version: 1.0.0

# Backup changed files.
# All original files will be saved with the .bak extension.
backupChanged: false

# Git settings.
git:
  # Allow commit not clean repository.
  commitDirty: false
  # Auto generate next patch version, if version exists.
  autoNextPatch: false
  # Allow version downgrades with --version flag.
  allowDowngrades: false
  # Remote repository URL.
  remoteUrl: https://github.com/klimby/version-test

# Changelog settings.
changelog:
  # Generate changelog.
  generate: true
  # Changelog file name.
  file: CHANGELOG.md
  # Changelog title.
  title: "Changelog"
  # Issue url template.
  # Examples:
  # 	- IssueURL: https://company.atlassian.net/jira/software/projects/PROJECT/issues/
  # 	- IssueURL: https://github.com/company/project/issues/
  # If empty, ang repository is CitHub, then issueHref will be set from remote repository URL.
  issueUrl: https://github.com/klimby/version-test/issues/
  # Show author in changelog.
  showAuthor: false
  # Show body in changelog comment.
  showBody: true
  # Commit types for changelog.
  # Type - commit type, value - commit type name.
  # If empty, then all commit types will be used, except Breaking Changes.
  commitTypes:
    - type: "feat"
      name: "Features"
    - type: "fix"
      name: "Bug Fixes"
    - type: "perf"
      name: "Performance Improvements"
    - type: "refactor"
      name: "Code Refactoring"
    - type: "style"
      name: "Styles"
    - type: "test"
      name: "Tests"
    - type: "build"
      name: "Builds"
    - type: "docs"
      name: "Documentation"
    - type: "revert"
      name: "Reverts"
    - type: "ci"
      name: "Continuous Integration"
    - type: "chore"
      name: "Other changes"

# Bump files.
# Change version in files. Version will be changed with format: <digital>.<digital>.<digital>
# Every entry has format:
# - file: file patch
#   start: number (optional)
#   end: number (optional)
#   regexp: regular expression for string search (optional, array)
# 
# If file is composer.json or package.json, then regexp and start/end are ignored.
#
# Examples:
# - file: README.md
#   regexp: 
#	  - ^Version:.+$
# 
# All strings from file, that match regexp will be replaced with new version.
#
# - file: ./dir/file.txt
#   start: 0
#   end: 100
#
# All strings from file, from 0 to 100 will be replaced with new version.
#
# - file: README.md
#   regexp: 
#	  - ^Version:.+$
#   start: 0
#   end: 100
#
# All strings from file, from 0 to 100, that match regexp will be replaced with new version.
#
bump:
  - file: package.json
  - file: composer.json
  - file: README.md
    regexp:
      - ^Version:.+$
  - file: ./dir/file.txt
    start: 0
    end: 100
  - file: ./dir/file2.txt
    start: 0
    end: 10
    regexp:
      - ^Version:.+$
      - ^Ver:.+$

```

### Next command

Command for creating next version, add content to changelog, bump files and commit changes:

```bash
$ version next --help
Generate next version.

Usage:
  version next [flags]

Flags:
  -h, --help         help for next
      --major        next major version
      --minor        next minor version
      --patch        next patch version
      --ver string   next build version in format 1.2.3

Global Flags:
  -b, --backup          backup changed files
  -c, --config string   config file path (default "version.yaml")
      --dir string      working directory, default - current
  -d, --dry             dry run
  -f, --force           force mode
  -s, --silent          silent run
```

### Remove command

Command for remove backup files:

```bash
$ version remove --help
Remove backup files, if exists

Usage:
  version remove [flags]

Flags:
      --backup   remove backup files
  -h, --help     help for remove

Global Flags:
  -c, --config string   config file path (default "version.yaml")
      --dir string      working directory, default - current
  -d, --dry             dry run
  -f, --force           force mode
  -s, --silent          silent run
```
